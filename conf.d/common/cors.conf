# ============================================================================
# CORS Settings for API Routes
# ============================================================================
# Purpose: Enable CORS for API routes to allow cross-origin requests
# Usage: Include this file in locations that need CORS support
# ============================================================================

# CORS headers for all requests
add_header 'Access-Control-Allow-Origin' '*' always;
add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, PATCH, OPTIONS' always;
add_header 'Access-Control-Allow-Headers' 'Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization, accept, origin, Cache-Control, X-Requested-With' always;
add_header 'Access-Control-Max-Age' 3600 always;

# Handle OPTIONS preflight requests
# Note: All CORS headers must be inside the if block due to nginx if limitations
if ($request_method = 'OPTIONS') {
    add_header 'Access-Control-Allow-Origin' '*' always;
    add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, PATCH, OPTIONS' always;
    add_header 'Access-Control-Allow-Headers' 'Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization, accept, origin, Cache-Control, X-Requested-With' always;
    add_header 'Access-Control-Max-Age' 3600 always;
    add_header 'Content-Type' 'text/plain' always;
    add_header 'Content-Length' 0 always;
    return 204;
}
