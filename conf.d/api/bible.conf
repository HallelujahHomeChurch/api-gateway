# ============================================================================
# Bible API Routes (via Dapr)
# ============================================================================
# Pattern: /api/bible/v*
# Backend: bible-api service via Dapr sidecar
# Dapr app-id: bible-api
# ============================================================================

# Version content streaming endpoint
location ~ ^/api/bible/v[0-9]+/version/[0-9]+$ {
    limit_req zone=api_limit burst=10 nodelay;  # Lower burst for streaming

    include /usr/local/openresty/nginx/conf/conf.d/common/cors.conf;
    include /usr/local/openresty/nginx/conf/conf.d/common/streaming.conf;  # Use streaming config
    proxy_pass $bible_api_base$uri$is_args$args;
}

# Other Bible API endpoints
location ~ ^/api/bible/v[0-9]+ {
    limit_req zone=api_limit burst=50 nodelay;

    include /usr/local/openresty/nginx/conf/conf.d/common/cors.conf;
    include /usr/local/openresty/nginx/conf/conf.d/common/dapr.conf;
    proxy_pass $bible_api_base$uri$is_args$args;
}

